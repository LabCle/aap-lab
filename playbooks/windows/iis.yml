---
- name: Instalar IIS e configurar site de teste
  hosts: windows
  gather_facts: yes
  tasks:

    - name: Garantir que a feature IIS esteja instalada
      ansible.windows.win_feature:
        name: Web-Server
        state: present
        include_management_tools: yes

    - name: Parar e remover o site default
      community.windows.win_iis_website:
        name: "Default Web Site"
        state: absent

    - name: Garantir que o diret√≥rio do site exista
      ansible.windows.win_file:
        path: C:\inetpub\meusite
        state: directory

    - name: Criar arquivo index.html de teste
      ansible.windows.win_copy:
        dest: C:\inetpub\meusite\index.html
        content: |
          <html>
          <head><title>Lab AAP - IIS</title></head>
          <body>
            <h1>Site IIS configurado pelo Ansible!</h1>
            <p>Host: {{ ansible_host }}</p>
            <p>Data/Hora: {{ ansible_date_time.iso8601 }}</p>
          </body>
          </html>

    - name: Criar novo site no IIS
      community.windows.win_iis_website:
        name: "LabAAPSite"
        state: started
        port: 80
        physical_path: C:\inetpub\meusite
        application_pool: DefaultAppPool
