---
- name: Instalar IIS e configurar site
  hosts: windows
  gather_facts: no
  tasks:
    - name: Garantir que o IIS esteja instalado
      ansible.windows.win_feature:
        name: Web-Server
        state: present

    - name: Garantir que o serviço IIS esteja rodando
      ansible.windows.win_service:
        name: W3SVC
        state: started
        start_mode: auto

    - name: Criar diretório do site
      ansible.windows.win_file:
        path: C:\inetpub\wwwroot\lab
        state: directory

    - name: Criar página index.html
      ansible.windows.win_copy:
        dest: C:\inetpub\wwwroot\lab\index.html
        content: |
          <html>
            <head><title>Lab AAP - IIS</title></head>
            <body>
              <h1>Servidor IIS configurado pelo Ansible!</h1>
              <p>Host: {{ inventory_hostname }}</p>
              <p>Data/Hora: {{ ansible_date_time.iso8601 }}</p>
            </body>
          </html>

    - name: Configurar Default Website para apontar para nova pasta
      community.windows.win_iis_website:
        name: "Default Web Site"
        state: started
        port: 80
        physical_path: C:\inetpub\wwwroot\lab
